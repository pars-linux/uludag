#!/usr/bin/python

import os
import sys
from distutils.sysconfig import get_config_var as pyconf

if sys.version_info[1] == 3:
    libs = [ 'db', 'm', "python2.3" ]
else:
    libs = [ 'db', 'm', "python2.4" ]

libpath = [ '/usr/lib' ]
cpppath = [ pyconf('CONFINCLUDEPY'), "../include" ]
ccflags = "-O2 -Wall -DVERSION='\"1.0\"' "

env = Environment(CCFLAGS=ccflags, CPPPATH=cpppath, LIBS=libs, LIBPATH=libpath)

Export('env')
comar = SConscript('src/SConscript', build_dir='build', duplicate=0)
libcomar, hav = SConscript('bindings/SConscript', build_dir='build/bindings', duplicate=0)

prefix = ARGUMENTS.get('prefix', 'install')

bindir = os.path.join(prefix, 'usr/bin')
libdir = os.path.join(prefix, 'usr/lib')
incdir = os.path.join(prefix, 'usr/include')
etcdir = os.path.join(prefix, 'etc/comar')

env.Install(bindir, comar)
env.Install(etcdir, 'model.xml')
env.Install(incdir, 'bindings/libcomar.h')
env.Install(libdir, libcomar)
env.Install(bindir, hav)

env.Alias('install', [ bindir, etcdir, libdir, incdir ])
