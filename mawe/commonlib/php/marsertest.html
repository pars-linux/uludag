<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

    <!--
    *    TUBITAK UEKAE 2005-2006
    *    marser - version 0.1
    -->

    <head>
        <title>marser - test</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <script src="../js/prototype.js"></script>

        <script>
        timer = 0;
        var myGlobalHandlers = {
		onCreate: function(){
			Element.show('working');
		},

		onComplete: function() {
			if(Ajax.activeRequestCount == 0){
				Element.hide('working');
			}
		}
	};

	Ajax.Responders.register(myGlobalHandlers);

        function showCoded(){
            timer = clearTimeout(timer);
            timer = setTimeout('finishCoded()', 1000);
        }

        function finishCoded() {
            var linke='text='+$('textinput').value;
            var url ='marser.php';
            var myAjax = new Ajax.Request(url,
                                              {
                                               method:'post',
                                               parameters: linke,
                                               onComplete: showit,
                                              }
                                         );
        }

        function showit(originalRequest){
            var newData = originalRequest.responseText;
            Element.hide('working');
            $('codedpage').innerHTML = newData;
            $('codedpage_source').value = newData;
        }

        function addcode(v){
            if (document.selection) // IE içün
            {
                var str = document.selection.createRange().text;
                document.getElementById('textinput').focus();
                var sel = document.selection.createRange();
                sel.text = "[" + v + "]" + str + "[/" + v + "]";
                finishCoded();
            }
            else if ((typeof document.getElementById('textinput').selectionStart) != 'undefined') // Hola Firefox
            {
                var txtarea = document.getElementById('textinput');
                var selLength = txtarea.textLength;
                var selStart = txtarea.selectionStart;
                var selEnd = txtarea.selectionEnd;
                var oldScrollTop = txtarea.scrollTop;
                var s1 = (txtarea.value).substring(0,selStart);
                var s2 = (txtarea.value).substring(selStart, selEnd)
                var s3 = (txtarea.value).substring(selEnd, selLength);
                txtarea.value = s1 + '[' + v + ']' + s2 + '[/' + v + ']' + s3;
                txtarea.selectionStart = s1.length;
                txtarea.selectionEnd = s1.length + 5 + s2.length + v.length * 2;
                txtarea.scrollTop = oldScrollTop;
                finishCoded();
            }
            else input('[' + v + '][/' + v + '] ');
        }

        </script>
    </head>

<body onload="finishCoded();">

    <h2> Marser Test ..</h2>

    <div>
        <div><input type="submit" onclick="addcode('b')" value="B"></div>
        <div id="textform" style="float:left;width:50%;">
            <h4>bbcode</h4>
            <textarea style="width:100%;border:1px solid #555;" rows=15 id="textinput" onKeyUp="showCoded();"></textarea>
        </div>

        <div id="textform" style="float:left;width:48%;padding-left:3px;">
            <h4>htmlsource</h4>
            <textarea DISABLED style="width:100%;border:1px solid #555;background:#FFF;color:#000;" rows=15 id="codedpage_source"></textarea>
        </div>
    </div>
    
    <div>
        <h4>Preview</h4>
        <div id='working' style="position:absolute; left:45%; right:45%;"><img src="indic.gif" /></div>
        <div id="codedpage" style="border:1px solid #EEF;clear:left;"></div>
    </div>

</body>
</html>